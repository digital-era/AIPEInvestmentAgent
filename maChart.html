<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>LightweightCharts ES Module 示例</title>
<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    background: #181818;
    color: #EAEAEA;
    font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
    display: flex; flex-direction: column;
  }
  header {
    padding: 20px;
    border-bottom: 1px solid #3A3A3A;
    text-align: center;
    font-size: 2rem;
    color: #a0d2eb;
  }
  #chart {
    flex: 1;
    min-height: 600px;
  }
</style>
</head>
<body>
<header>均线分析 - LightweightCharts ES Module</header>
<div id="chart"></div>

<script type="module">
  import { createChart } from 'https://cdn.jsdelivr.net/npm/lightweight-charts@5.0.8/+esm';

  const chart = createChart(document.getElementById('chart'), {
    width: window.innerWidth,
    height: 600,
    layout: {
      backgroundColor: '#181818',
      textColor: '#EAEAEA',
    },
    rightPriceScale: {
      borderColor: '#555',
    },
    timeScale: {
      borderColor: '#555',
      timeVisible: true,
      secondsVisible: false,
    },
    grid: {
      vertLines: { color: '#444' },
      horzLines: { color: '#444' },
    },
  });

  const candleSeries = chart.addCandlestickSeries({
    upColor: '#26a69a',
    downColor: '#ef5350',
    borderDownColor: '#ef5350',
    borderUpColor: '#26a69a',
    wickDownColor: '#ef5350',
    wickUpColor: '#26a69a',
  });

  const candleData = [
    { time: '2023-06-01', open: 100, high: 105, low: 95, close: 102 },
    { time: '2023-06-02', open: 102, high: 108, low: 101, close: 107 },
    { time: '2023-06-05', open: 107, high: 110, low: 104, close: 106 },
    { time: '2023-06-06', open: 106, high: 109, low: 103, close: 104 },
    { time: '2023-06-07', open: 104, high: 107, low: 101, close: 105 },
    { time: '2023-06-08', open: 105, high: 108, low: 102, close: 107 },
    { time: '2023-06-09', open: 107, high: 111, low: 106, close: 110 },
  ];
  candleSeries.setData(candleData);

  // 计算简单移动平均（SMA）
  function calculateSMA(data, period) {
    const sma = [];
    for (let i = 0; i < data.length; i++) {
      if (i < period - 1) {
        sma.push({ time: data[i].time, value: null });
        continue;
      }
      let sum = 0;
      for (let j = i - period + 1; j <= i; j++) {
        sum += data[j].close;
      }
      sma.push({ time: data[i].time, value: sum / period });
    }
    return sma;
  }

  const maPeriods = [5, 10, 20];
  const maColors = ['#e67e22', '#3498db', '#9b59b6'];

  maPeriods.forEach((period, idx) => {
    const lineSeries = chart.addLineSeries({
      color: maColors[idx],
      lineWidth: 2,
    });
    const maData = calculateSMA(candleData, period).filter(d => d.value !== null);
    lineSeries.setData(maData);
  });

  // 监听窗口大小调整，调整图表宽度
  window.addEventListener('resize', () => {
    chart.applyOptions({ width: window.innerWidth });
  });
</script>
</body>
</html>
